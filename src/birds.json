{
    "width": 1000,
    "height": 600,
    "data": {
        "url": "https://gist.githubusercontent.com/jonathanzong/5f4fa36e8c2cd04639bc550540264dc6/raw/6cb2070b6ffdd2d4bc1a91fdd635737048414881/bird_data.csv"
    },
    "transform": [{ "calculate": "toNumber(datum.day)", "as": "n_day" }],
    "projection": {
        "type": "mercator"
    },
    "encoding": {
        "longitude": {
            "field": "lon"
        },
        "latitude": {
            "field": "lat"
        },
        "color": {
            "field": "species"
        },
        "time": {
            "field": "n_day",
            "scale": {
                "type": "band",
                "range": { "step": 100 }
            },
            "continuity": {
                "field": "species"
            }
        }
    },
    "layer": [{
            "mark": "circle",
            "params": {
                "name": "birds",
                "select": {
                    "type": "point",
                    "on": {
                        "type": "timer"
                    },
                    "predicate": {
                        "and": [{ "field": "day", "eq": "invert('time', anim_clock)" }]
                    }
                }
            },
            "transform": [{
                "filter": {
                    "param": "birds"
                }
            }],
            "encoding": {
                "opacity": { "value": 1 }
            }
        },
        {
            "mark": "circle",
            "params": [{
                "name": "trails",
                "select": {
                    "type": "point",
                    "on": {
                        "type": "timer"
                    },
                    "predicate": {
                        "and": [
                            { "field": "day", "gt": "invert('time', anim_clock)-10" },
                            { "field": "day", "lte": "invert('time', anim_clock)-1" }
                        ]
                    }
                }
            }],
            "transform": [{
                "filter": {
                    "time": [{
                            "gt": "datum.day-10"
                        },
                        {
                            "lt": "datum.day"
                        }
                    ]
                }
            }],
            "encoding": {
                "opacity": { "value": 0.5 }
            }
        }
    ]
}